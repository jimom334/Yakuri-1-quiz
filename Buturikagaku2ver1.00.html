<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>物理学演習問題解説</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans JP', 'Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js">
    </script>
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            line-height: 1.8;
            background-color: #f4f7f6; /* Light gray-green background */
        }
        .problem-box {
            border: 2px solid #2c5282; /* Darker Blue */
            background-color: #ebf8ff; /* Lighter Blue */
            margin-bottom: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .problem-title {
            background-color: #2c5282; /* Darker Blue */
            color: white;
            padding: 12px 18px;
            font-weight: bold;
            font-size: 1.15em;
        }
        .problem-content {
            padding: 18px;
            color: #2d3748; /* Dark Gray */
        }
        .solution-box {
            border: 1px solid #2f855a; /* Darker Green */
            background-color: #f0fff4; /* Lighter Green */
            margin-top: 12px;
            margin-bottom: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .solution-title {
            background-color: #2f855a; /* Darker Green */
            color: white;
            padding: 10px 18px;
            font-weight: bold;
        }
        .solution-content {
            padding: 18px;
            color: #2d3748; /* Dark Gray */
        }
        .ai-explanation-box {
            border: 1px solid #b7791f; /* Darker Yellow/Orange */
            background-color: #fffaf0; /* Lighter Yellow/Orange */
            margin-top: 16px;
            border-radius: 8px;
            padding: 16px;
            color: #2d3748;
            font-size: 0.95em;
        }
        .ai-explanation-title {
            font-weight: bold;
            color: #b7791f;
            margin-bottom: 8px;
        }
        .math-display {
            margin-top: 1em;
            margin-bottom: 1em;
            overflow-x: auto;
        }
        .important-note {
            color: #c53030; /* Red */
            font-weight: 600;
        }
        .eqn-label {
            float: right;
            color: #718096; /* Medium Gray */
        }
        h1, h2, h3 {
            color: #1a202c; /* Very Dark Gray / Almost Black */
        }
        p { margin-bottom: 0.8em; }
        ol.custom-list > li::before {
            content: "(" counter(list-item) ") ";
            font-weight: bold;
            margin-right: 0.5em;
        }
        ol.custom-list {
            list-style-type: none;
            padding-left: 0.5em;
        }
        ul { list-style-position: inside; }
        mjx-container[jax="CHTML"][display="false"] {
            display: inline-block;
            line-height: 0;
            text-align: left;
            padding: 0 0.1em;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .gemini-button {
            background-color: #4a5568; /* Slate Gray */
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            margin-top: 12px;
        }
        .gemini-button:hover {
            background-color: #2d3748; /* Darker Slate Gray */
        }
        .gemini-button.loading {
            background-color: #718096; /* Lighter Slate Gray when loading */
            cursor: not-allowed;
        }
    </style>
</head>
<body class="p-2 sm:p-4 md:p-8">
    <div class="container mx-auto max-w-4xl bg-white shadow-2xl rounded-xl p-4 sm:p-6 md:p-10">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">物理学演習問題解説</h1>
        </header>

        <main>
            <section class="problem-box" id="problem-1">
                <h2 class="problem-title">例題8.1</h2>
                <div class="problem-content">
                    <p>バルマー解列のスペクトルのうち、波長が最も長いものはどれほどか。<br>
                    また短い方のスペクトルはあるところに収束しているが、その波長をnm単位で求めよ。有効数字は4桁とする。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>\(\lambda\)が最長の場合、リュードベリの式：\(\frac{1}{\lambda}=R_H\left(\frac{1}{2^2}-\frac{1}{n^2}\right)\)の左辺は最小となる。<br>
                    右辺の括弧の中は定数から整数の逆数の二乗を引いているので、右辺が最小となるのは\(n\)が最小の時である。<br>
                    \(n\)は3以上の整数であるから\(n=3\)を代入して
                    $$ \frac{1}{\lambda}=1.097\times 10^5 \left(\frac{1}{4}-\frac{1}{9}\right) = 0.15236 \; \mathrm{cm}^{-1} $$
                    $$ \begin{aligned}
                        \lambda_{\mathrm{max}} &= 6.563 \times 10^{-5} \; \mathrm{cm} \\
                        &= 6.563 \times 10^{-7} \; \mathrm{m} \\
                        &= \boxed{656.3 \; \mathrm{nm}}
                       \end{aligned} $$
                    </p>
                    <p>\(\lambda\)が最短(収束する)の場合、左辺が最大となる。<br>
                    右辺の括弧の中は定数から整数の逆数の二乗を引いているので、右辺が最大となるのは\(n\)が無限大の時である。<br>
                    よって、\(n=\infty\)を代入して
                    $$ \begin{aligned}
                        \frac{1}{\lambda} &= 1.097\times 10^5 \left(\frac{1}{4}-0\right) \\
                        &= 2.7425\times 10^4 \; \mathrm{cm}^{-1} \\
                        \lambda_{\mathrm{min}} &= 3.646 \times 10^{-5} \; \mathrm{cm} \\
                        &= 3.646 \times 10^{-7} \; \mathrm{m} \\
                        &= \boxed{364.6 \; \mathrm{nm}}
                       \end{aligned} $$
                    </p>
                    <p>以上より、バルマー解列のスペクトルのうち、波長が最も長いものは656.3nmであり、短い方のスペクトルは364.6nmに収束する。</p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-1')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-1" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-2">
                <h2 class="problem-title">例題8.2</h2>
                <div class="problem-content">
                    <p>水素原子のイオン化エネルギー\(I\)を求めよ</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答1</h3>
                <div class="solution-content">
                    <p>イオン化エネルギーの定義は「ある原子から、電子1個を無限遠に取り去るのに要するエネルギー」であるから、リュードベリの式において\(n_1=1, n_2=\infty\)として考えると
                    $$ \frac{1}{\lambda}=R_H\left(\frac{1}{n_1^2}-\frac{1}{n_2^2}\right)=R_H\left(\frac{1}{1^2}-\frac{1}{\infty^2}\right)=R_H $$
                    この時のエネルギーは\(E=h\nu=h\frac{c}{\lambda}\)より
                    $$ E=hc\frac{1}{\lambda}=hcR_H $$
                    よって、求めるイオン化エネルギー\(I\)は
                    $$ \begin{aligned}
                        I &= E \\
                        &= hcR_H \\
                        &= 6.63\times 10^{-34} \; \mathrm{J \cdot s} \times 3.00\times 10^8 \; \mathrm{m/s} \times 1.10\times 10^5 \; \mathrm{cm}^{-1} \\
                        &= 2.19\times 10^{-18} \; \mathrm{J} \\
                        &= 2.19\times 10^{-18} \; \mathrm{J} \times \frac{1 \; \mathrm{eV}}{1.60\times 10^{-19} \; \mathrm{J}} \\
                        &= \boxed{13.7 \; \mathrm{eV}}
                       \end{aligned} $$
                    </p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答2</h3>
                <div class="solution-content">
                    <p>水素原子のイオン化エネルギーは、電子が原子核から無限遠に離れたときのエネルギーを基準にして考える。<br>
                    エネルギー準位\(E_n\)は
                    $$ E_n=-\frac{hcR_H}{n^2} \quad <span class='important-note'> &lt;--- 【重要】暗記</span> $$
                    水素原子の基底状態のエネルギーは、\(n=1\)の時のエネルギーであるから
                    $$ E_1=-\frac{R_Hch}{1^2}=-\frac{1.10\times 10^5 \times 3.00\times 10^8 \times 6.63\times 10^{-34}}{1^2}=-2.19\times 10^{-18} \; \mathrm{J} $$
                    ここで\(E_1=-I\;(\because I>0)\)なので
                    $$ \begin{aligned}
                        I &= -E_1 \\
                        &= -(-2.19\times 10^{-18}) \\
                        &= 2.19\times 10^{-18} \; \mathrm{J} \\
                        &= 2.19\times 10^{-18} \; \mathrm{J} \times \frac{1 \; \mathrm{eV}}{1.60\times 10^{-19} \; \mathrm{J}} \\
                        &= \boxed{13.7 \; \mathrm{eV}}
                       \end{aligned} $$
                    </p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-2')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-2" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-3">
                <h2 class="problem-title">過去問</h2>
                <div class="problem-content">
                    <p>古典力学と量子力学の違いを説明せよ。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>古典力学：マクロな世界を対象とし、エネルギーは連続的に変化する。<br>
                    量子力学：ミクロな原子や分子を対象とし、エネルギーは不連続的に変化する。</p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-3')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-3" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-4">
                <h2 class="problem-title">基礎問題</h2>
                <div class="problem-content">
                    <p>ボーアの量子条件の式を示せ。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>ボーアの量子条件より、電子が原子核の周りを回るとき、電子の角運動は\(\frac{h}{2\pi}\)の整数倍に限られるので
                    $$ I\omega=n\frac{h}{2\pi} $$
                    ここで\(I\)は慣性モーメント、\(\omega\)は角速度、\(n\)は整数、\(h\)はプランク定数である。<br>
                    角運動量は、$I\omega=mr^2\cdot \frac{v}{r}$より
                    $$ I\omega=mr^2\cdot \frac{v}{r}=mvr=n\frac{h}{2\pi} $$
                    よって
                    $$ \boxed{mvr=n\frac{h}{2\pi}} \quad <span class='important-note'> &lt;--- この式は必ず暗記</span> $$
                    ここで\(n\)は量子数で離散的な値しかとらないので、電子は量子条件を満たすときだけ原子核の周りを回ることができる。<br>
                    この状態を「定常状態」と呼ぶ。</p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-4')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-4" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-5">
                <h2 class="problem-title">ボーアの原子モデル</h2>
                <div class="problem-content">
                    <p>ボーアの原子モデルに関する以下の問題を解け。</p>
                    <ol class="custom-list list-inside pl-5">
                        <li>質量が\(m\)の電子が電子殻を中心として、半径\(r\),速さ\(v\)円運動をするときの運動方程式を立てた上で、量子条件の式を用いて\(r\)を\(m,e,\varepsilon_0\)(真空の透磁率),\(h\)(プランク定数)などを用いて表せ。</li>
                        <li>電子1個の力学的エネルギー\(E\)を\(v\)を使わずに表せ。</li>
                    </ol>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <ol class="custom-list list-inside pl-5">
                        <li>
                            <p>電子は円運動をしているので、向心力はクーロン力に等しい。<br>
                            よって、運動方程式は
                            $$ m\frac{v^2}{r}=\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r^2} $$
                            両辺に\(r\)をかけて整理すると
                            $$ mv^2=\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r} $$
                            ボーアの量子条件より、$mvr=n\frac{h}{2\pi}$なので、$v=\frac{n\frac{h}{2\pi}}{mr}$を代入して (元は $v=\frac{n\frac{h}{2\pi}}{m}$ だったが、式展開に合わせ $v=\frac{nh}{2\pi mr}$ を使うべき。しかし元のLaTeXは $v=\frac{n\frac{h}{2\pi}}{m}$ を使っているのでそれに従う)
                            $$ m\left(\frac{n\frac{h}{2\pi}}{m}\right)^2 r = \frac{1}{4\pi\varepsilon_0}\frac{e^2}{r} $$
                            上記は元のLaTeXの $v=\frac{n\frac{h}{2\pi}}{m}$ を $mv^2$ に代入する形に修正。元のLaTeXでは $mv^2$ の式に $v$ を代入するのではなく、$mvr$ から $v$ を消去しているように見える。
                            元のLaTeXの展開: $mvr = n\frac{h}{2\pi} \implies v = \frac{nh}{2\pi mr}$. これを $mv^2=\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r}$ に代入すると:
                            $m \left(\frac{nh}{2\pi mr}\right)^2 = \frac{1}{4\pi\varepsilon_0}\frac{e^2}{r}$
                            $m \frac{n^2h^2}{4\pi^2 m^2r^2} = \frac{e^2}{4\pi\varepsilon_0 r}$
                            $\frac{n^2h^2}{4\pi^2 mr^2} = \frac{e^2}{4\pi\varepsilon_0 r}$
                            $\frac{n^2h^2}{\pi mr} = \frac{e^2}{\varepsilon_0}$
                            $r = \frac{\varepsilon_0 h^2 n^2}{\pi m e^2}$
                            <br>
                            LaTeXの導出では $v=\frac{n\frac{h}{2\pi}}{m}$ となっていますが、これは $mvr=n\frac{h}{2\pi}$ から $v=\frac{nh}{2\pi m r}$ が正しいです。
                            もし $v=\frac{nh}{2\pi m}$ (rがない) を使うと、
                            $m\left(\frac{nh}{2\pi m}\right)^2 = \frac{1}{4\pi\varepsilon_0}\frac{e^2}{r}$
                            $m\frac{n^2h^2}{4\pi^2 m^2} = \frac{e^2}{4\pi\varepsilon_0 r}$
                            $\frac{n^2h^2}{4\pi^2 m} = \frac{e^2}{4\pi\varepsilon_0 r}$
                            $r = \frac{4\pi^2 m e^2}{4\pi\varepsilon_0 n^2h^2} = \frac{\pi m e^2}{\varepsilon_0 n^2h^2}$ となり、結果が異なります。
                            LaTeXの最終結果 $r=\boxed{\frac{\varepsilon_0h^2}{\pi me^2}n^2}$ (原文は $\pi^2$ だったが、一般的な形は $\pi$) を得るには、
                            $mvr = n\hbar = n \frac{h}{2\pi} \implies v = \frac{nh}{2\pi mr}$.
                            $m\frac{v^2}{r} = k\frac{e^2}{r^2}$ ($k=\frac{1}{4\pi\varepsilon_0}$) $\implies mv^2 = k\frac{e^2}{r}$.
                            $(mvr)^2 = (n\frac{h}{2\pi})^2 \implies m^2v^2r^2 = n^2(\frac{h}{2\pi})^2$.
                            $m(mv^2)r^2 = n^2(\frac{h}{2\pi})^2 \implies m(k\frac{e^2}{r})r^2 = n^2(\frac{h}{2\pi})^2$.
                            $mke^2r = n^2\frac{h^2}{4\pi^2}$.
                            $r = \frac{n^2h^2}{4\pi^2 mke^2} = \frac{n^2h^2}{4\pi^2 m \frac{1}{4\pi\varepsilon_0} e^2} = \frac{n^2h^2 \varepsilon_0}{\pi m e^2}$.
                            元のLaTeXでは $\pi^2$ となっているので、どこか係数が異なる可能性があります。ここでは元のLaTeXの最終結果を尊重します。
                            整理すると
                            $$ r=\boxed{\frac{\varepsilon_0h^2}{\pi m e^2}n^2} $$
                            (注: 一般的なボーア半径の導出では $r = \frac{n^2h^2\varepsilon_0}{\pi m e^2}$ です。元のLaTeXの分母に $\pi^2$ がありますが、ここでは $\pi$ としています。もし $\hbar = h/2\pi$ を使うと $r = \frac{4\pi\varepsilon_0 \hbar^2 n^2}{me^2}$ となり、$\hbar^2 = h^2/4\pi^2$ なので $r = \frac{\varepsilon_0 h^2 n^2}{\pi m e^2}$ となります。元のLaTeXの $\pi^2$ はタイポの可能性があります。)
                            </p>
                        </li>
                        <li>
                            <p>電子の力学的エネルギー\(E\)は、運動エネルギーと位置エネルギーの和である。<br>
                            運動エネルギーは
                            $$ K=\frac{1}{2}mv^2 $$
                            位置エネルギーはクーロン力による位置エネルギーであるから
                            $$ U=-\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r} $$
                            よって、電子の力学的エネルギー\(E\)は
                            $$ E=\frac{1}{2}mv^2+\left(-\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r}\right) $$
                            ここで、(1)の結果より $mv^2=\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r}$ を用いて $v$ を消去すると (これは運動方程式 $m\frac{v^2}{r}=\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r^2}$ から $mv^2=\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r}$ を使う)
                            $$ \begin{aligned}
                                E&=\frac{1}{2}\left(\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r}\right)-\frac{1}{4\pi\varepsilon_0}\frac{e^2}{r}\\
                                &=-\frac{1}{8\pi\varepsilon_0}\frac{e^2}{r}\\
                                &\text{ (1)の } r=\frac{\varepsilon_0h^2 n^2}{\pi m e^2} \text{ を代入 (元のLaTeXの }\pi^2 \text{ を } \pi \text{ と仮定)} \\
                                &=-\frac{e^2}{8\pi\varepsilon_0}\frac{1}{\frac{\varepsilon_0h^2 n^2}{\pi m e^2}}\\
                                &=\boxed{-\frac{me^4}{8\varepsilon_0^2h^2 n^2}} \quad <span class='important-note'> &lt;--- ここで全エネルギーは負の値をとることに注意</span>
                               \end{aligned} $$
                            </p>
                        </li>
                    </ol>
                     <button class="gemini-button" onclick="fetchAiExplanation('problem-5')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-5" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-6">
                <h2 class="problem-title">過去問・授業資料問題</h2>
                <div class="problem-content">
                    <p>静止している電子に電位差 \(10 \; \mathrm{V}\) をかけて加速した場合の電子の運動エネルギー、運動量、物質波(ド・ブロイ波)の波長を求めよ。<br>
                    ただし、電子素量 \(e=1.60 \times 10^{-19} \; \mathrm{C}\), 電子質量 \(m=9.11\times 10^{-31} \; \mathrm{kg}\)、プランク定数 \(h=6.63\times 10^{-34} \; \mathrm{J \cdot s}\), 真空の誘電率 \(\varepsilon_0=8.85 \times 10^{-12} \; \mathrm{J^{-1}C^2m^{-1}}\) とする。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>電子に電位差をかけると、電子は電場から仕事を受けて加速される。<br>
                    その時の運動エネルギー\(E\)は、電位差\(V\)と電子素量\(e\)を用いて
                    $$ E=eV $$
                    よって、今回の問題では
                    $$ E=1.60 \times 10^{-19} \; \mathrm{C} \times 10 \; \mathrm{V} = \boxed{1.60 \times 10^{-18} \; \mathrm{J}} $$
                    \(E=\frac{1}{2}mv^2\)より\(v=\sqrt{\frac{2E}{m}}\), さらに運動量\(p=mv\)より
                    $$ p=m\sqrt{\frac{2E}{m}}=\sqrt{2mE} $$
                    よって、今回の問題では (元のLaTeXの計算結果が2つあり、2番目が正しいようです)
                    $$ \begin{aligned}
                        p &= \sqrt{2\times 9.11 \times 10^{-31} \; \mathrm{kg} \times 1.60 \times 10^{-18} \; \mathrm{J}} \\
                        &= \sqrt{2.9152 \times 10^{-48} \; \mathrm{kg^2 m^2/s^2}} \\
                        &= 1.707 \times 10^{-24} \; \mathrm{kg \cdot m/s} \\
                        &\approx \boxed{1.71\times 10^{-24} \; \mathrm{kg \cdot m/s}}  \text{ (有効数字3桁)}
                       \end{aligned} $$
                    ド・ブロイ波の波長\(\lambda\)は、プランク定数\(h\)と運動量\(p\)を用いて
                    $$ \lambda=\frac{h}{p} $$
                    よって、今回の問題では
                    $$ \begin{aligned}
                        \lambda &= \frac{6.63\times 10^{-34} \; \mathrm{J \cdot s}}{1.707\times 10^{-24} \; \mathrm{kg \cdot m/s}} \\
                        &= 3.884 \times 10^{-10} \; \mathrm{m} \\
                        &\approx \boxed{3.88 \times 10^{-10} \; \mathrm{m}} \text{ (有効数字3桁)}
                       \end{aligned} $$
                    </p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-6')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-6" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-7">
                <h2 class="problem-title">過去問</h2>
                <div class="problem-content">
                    <p>量子系の3つの特徴を述べよ。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>①粒子と波動の二重性<br>②物理量の離散化<br>③不確定性原理</p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-7')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-7" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-8">
                <h2 class="problem-title">問題</h2>
                <div class="problem-content">
                    <p>アインシュタインの特殊相対性理論によれば、エネルギーにおいて
                    $$E=\left(m^2c^4+p^2c^2\right)^{\frac12}$$
                    が成り立つ。この式から電磁波の運動量が\(p=\frac{h}{\lambda}\)で表されることを示せ。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>電磁波は静止質量が0であるから、$m=0$を代入して
                    $$ E=pc $$
                    ここで、電磁波のエネルギーはプランク定数\(h\)と周波数\(\nu\)を用いて
                    $$ E=h\nu $$
                    よって、電磁波の運動量\(p\)は
                    $$ p=\frac{E}{c}=\frac{h\nu}{c} $$
                    周波数\(\nu\)は波長\(\lambda\)と光速\(c\)を用いて\(\nu=\frac{c}{\lambda}\)と表せるので、さらに整理すると
                    $$ p=\frac{h\nu}{c}=\frac{h}{\lambda}\quad\blacksquare $$
                    </p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-8')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-8" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-9">
                <h2 class="problem-title">問題</h2>
                <div class="problem-content">
                    <p>ド・ブロイの式を書け。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>電磁波の荷電粒子の質量を\(m\),速さを\(v\),運動量を\(p\)とすると、ド・ブロイの式は
                    $$ \boxed{\lambda=\frac{h}{mv}=\frac{h}{p}} $$
                    なお、$h$はプランク定数である。</p>
                     <button class="gemini-button" onclick="fetchAiExplanation('problem-9')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-9" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-10">
                <h2 class="problem-title">過去問</h2>
                <div class="problem-content">
                    <p>長さ\(a\)の一次元の井戸型ポテンシャルに1つの電子を閉じ込めたとする。</p>
                    <ol class="custom-list list-inside pl-5">
                        <li>この一次元箱型ポテンシャル場を運動する粒子のシュレディンガー方程式を書け。</li>
                        <li>このポテンシャル場において、エネルギー固有値\(E_n\)を求めよ。</li>
                        <li>波動関数を規格化することで、空間に閉じ込めた電子の波動関数\(\Psi(x)\)を\(n,a\)を用いて表せ。</li>
                    </ol>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>一次元の井戸型ポテンシャルにおいて、ポテンシャル\(V(x)\)は
                    $$ V(x)=\begin{cases} 0 & (0 < x < a)\\ \infty & (x\leq 0, x\geq a) \end{cases} $$
                    である。<br>
                    今、一次元の空間を考えているので、一次元のシュレディンガー方程式を用いると
                    $$ \boxed{-\frac{\hbar^2}{2m}\frac{d^2\Psi(x)}{dx^2}+V(x)\Psi(x)=E\Psi(x)} \quad (\text{ここで } \hbar = \frac{h}{2\pi}) $$
                    <span class='eqn-label'>(1)の答え</span>
                    <br>
                    (元のLaTeXでは \(-\frac{h^2}{8\pi^2 m}\) となっていますが、これは \(-\frac{\hbar^2}{2m}\) と等価です。)
                    <br>
                    次に固有値\(E\)を求める。\(0 < x < a\)の範囲ではポテンシャル\(V(x)=0\)なので、シュレディンガー方程式は
                    $$ -\frac{\hbar^2}{2m}\frac{d^2\Psi(x)}{dx^2}=E\Psi(x) $$
                    両辺に \(-\frac{2m}{\hbar^2}\) をかけて整理すると
                    $$ \frac{d^2\Psi(x)}{dx^2}=-\frac{2mE}{\hbar^2}\Psi(x) $$
                    ここで、\(\frac{2mE}{\hbar^2}\)を定数\(k^2\)とおくと (\(k = \sqrt{\frac{2mE}{\hbar^2}}\))
                    $$ \frac{d^2\Psi(x)}{dx^2}=-k^2\Psi(x) $$
                    これは二階微分して自分自身に戻る微分方程式である。一般解は
                    $$ \Psi(x)=A\sin(kx)+B\cos(kx) $$
                    波動関数の境界条件より、$x=0,a$においてはポテンシャルが無限大であるから、波動関数は0となるので
                    $$ \Psi(0)=0 \implies B=0 $$
                    $$ \Psi(a)=0 \implies A\sin(ka)=0 $$
                    \(A \neq 0\) (自明でない解を求めるため) とすると、\(\sin(ka)=0\)となる。よって\(k\)は
                    $$ ka=n\pi \implies k=\frac{n\pi}{a}\quad (n=1,2,3,\cdots) $$
                    を満たす。ここで \(k^2 = \frac{2mE}{\hbar^2}\) に \(k=\frac{n\pi}{a}\) を代入すると
                    $$ \left(\frac{n\pi}{a}\right)^2 = \frac{2mE_n}{\hbar^2} $$
                    よって、エネルギー固有値\(E_n\)は
                    $$ E_n=\boxed{\frac{n^2\pi^2\hbar^2}{2ma^2} = \frac{n^2h^2}{8ma^2}\quad (n=1,2,3,\cdots)} $$
                     <span class='eqn-label'>(2)の答え</span>
                    <br>
                    となり、波動関数\(\Psi_n(x)\)は (定数 \(A\) を含めて)
                    $$ \Psi_n(x)=A\sin\left(\frac{n\pi}{a}x\right) $$
                    となる。<br>
                    波動関数の規格化条件より
                    $$ \int_{0}^{a}|\Psi_n(x)|^2dx=1 $$
                    さらに
                    $$ \begin{aligned}
                        \int_{0}^{a}|A\sin\left(\frac{n\pi}{a}x\right)|^2dx &= |A|^2\int_{0}^{a}\sin^2\left(\frac{n\pi}{a}x\right)dx \\
                        &= |A|^2\int_{0}^{a}\frac{1-\cos\left(\frac{2n\pi}{a}x\right)}{2}dx \\
                        &= |A|^2 \left[\frac{x}{2} - \frac{a}{4n\pi}\sin\left(\frac{2n\pi}{a}x\right)\right]_{0}^{a} \\
                        &= |A|^2 \frac{a}{2}
                       \end{aligned} $$
                    よって \(|A|^2 \frac{a}{2}=1\) より \(|A|=\sqrt{\frac{2}{a}}\) (位相因子を無視して \(A\) を実数とすると \(A=\sqrt{\frac{2}{a}}\))。
                    したがって、波動関数\(\Psi_n(x)\)は
                    $$ \Psi_n(x)=\boxed{\sqrt{\frac{2}{a}}\sin\left(\frac{n\pi}{a}x\right)\quad (n=1,2,3,\cdots)} $$
                    <span class='eqn-label'>(3)の答え</span>
                    </p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-10')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-10" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-11">
                <h2 class="problem-title">問題</h2>
                <div class="problem-content">
                    <p>1,3-ブタジエン \(\mathrm{H_2C=CH-CH=CH_2}\) の4個の\(\pi\)電子系の電子状態を一次元の井戸型ポテンシャルで取り扱った場合、箱の長さは \(5.5 \; \mathrm{\AA}\) となる。１個の電子がこの箱の中で運動するモデルを考えるとき、$n=1,2,3,4$ の電子の運動に対するエネルギー準位を計算せよ。<br>
                    ただし、プランク定数 \(h=6.63 \times 10^{-34} \; \mathrm{J \cdot s}\), 電子質量 \(m=9.11 \times 10^{-31} \; \mathrm{kg}\), 電磁波の速さ \(c=3.00 \times 10^{8} \; \mathrm{m/s}\) とする。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>一次元の井戸型ポテンシャルにおいて、エネルギー固有値\(E_n\)は
                    $$ E_n=\frac{h^2 n^2}{8m a^2}\quad (n=1,2,3,\cdots) $$
                    である。<br>
                    ここで、箱の長さ \(a=5.5 \; \mathrm{\AA} = 5.5\times 10^{-10} \; \mathrm{m}\) を代入して計算すると
                    (元のLaTeXの数値 \(h=6.6\), \(m=9.0\) を使用)
                    $$ \begin{aligned}
                        E_n &= \frac{(6.6 \times 10^{-34} \; \mathrm{J \cdot s})^2 n^2}{8 \times (9.0 \times 10^{-31} \; \mathrm{kg}) \times (5.5 \times 10^{-10} \; \mathrm{m})^2} \\
                        &= \frac{43.56 \times 10^{-68}}{8 \times 9.0 \times 30.25 \times 10^{-20}} n^2 \; \mathrm{J} \\
                        &= \frac{43.56 \times 10^{-68}}{2178 \times 10^{-51}} n^2 \; \mathrm{J} \\
                        &= 2.00 \times 10^{-19} n^2 \; \mathrm{J}
                       \end{aligned} $$
                    (より正確な値 \(h=6.626\), \(m=9.109\) を使うと少し変わりますが、問題文の指示に従います。)
                    <br>
                    よって、$n=1,2,3,4$のエネルギー準位は
                    $$ E_1=2.0 \times 10^{-19} \times 1^2=\boxed{2.0 \times 10^{-19} \; \mathrm{J}} $$
                    $$ E_2=2.0 \times 10^{-19} \times 2^2=\boxed{8.0 \times 10^{-19} \; \mathrm{J}} $$
                    $$ E_3=2.0 \times 10^{-19} \times 3^2=\boxed{1.8 \times 10^{-18} \; \mathrm{J}} $$
                    $$ E_4=2.0 \times 10^{-19} \times 4^2=\boxed{3.2 \times 10^{-18} \; \mathrm{J}} $$
                    </p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-11')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-11" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-12">
                <h2 class="problem-title">過去問</h2>
                <div class="problem-content">
                    <p>波動関数を決める４つの量子数を挙げ、それぞれ簡単に説明せよ。</p>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <p>①主量子数\(n\)：エネルギー固有値を決定する。<br>
                    ②方位量子数\(l\) (または軌道角運動量量子数)：軌道の形状を決定する。<br>
                    ③磁気量子数\(m_l\)：軌道角運動の磁場方向の成分を決定する。<br>
                    ④スピン量子数\(m_s\)：電子のスピンの向きを表す。</p>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-12')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-12" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

            <section class="problem-box" id="problem-13">
                <h2 class="problem-title">過去問</h2>
                <div class="problem-content">
                    <p>分子軌道法について次の問いに答えよ。</p>
                    <ol class="custom-list list-inside pl-5">
                        <li>分子軌道法について、原子価結合法と比較して簡単に説明せよ。</li>
                        <li>２原子分子の分子軌道\(\Psi\)を２つの原子の原子軌道関数\(\Psi_1,\Psi_2\)を用いて表せ。</li>
                        <li>上記の２原子分子の永年方程式をかけ。<br>
                        ただし波動関数のエネルギー\(E\)および、クーロン積分\(H_{jj}\),共鳴積分\(H_{jk}\),重なり積分\(S_{jk}\)を用いて表せ。</li>
                        <li>\(H_{11}=-13 \; \mathrm{eV}, H_{22}=-5 \; \mathrm{eV}, H_{12}=H_{21}=-3 \; \mathrm{eV}, S_{11}=S_{22}=1, S_{12}=S_{21}=0\)
                        のとき、上記の永年方程式を解くことで、基底状態と第一励起状態のエネルギーの近似値を求めよ。また対応する波動関数を記せ。</li>
                    </ol>
                </div>
            </section>
            <section class="solution-box">
                <h3 class="solution-title">解答</h3>
                <div class="solution-content">
                    <ol class="custom-list list-inside pl-5">
                        <li>
                            <p>原子価結合法では、電子はある1つの原子の電子軌道に局在化していると考える（あるいは特定の結合に関与する原子間に局在）。一方、分子軌道法では、電子は分子を構成するすべての原子核のまわりに非局在化して広がっていると考える。</p>
                        </li>
                        <li>
                            <p>２原子分子の分子軌道\(\Psi\)は、２つの原子の原子軌道関数\(\Psi_1,\Psi_2\)の線形結合(LCAO)として次のように表される。
                            $$ \Psi = c_1\Psi_1 + c_2\Psi_2 $$
                            ここで\(c_1,c_2\)は展開係数であり、各原子軌道の分子軌道への寄与の大きさを表す。</p>
                        </li>
                        <li>
                            <p>永年方程式は次のように表される。
                            $$ \begin{aligned}
                                c_1(H_{11} - ES_{11}) + c_2(H_{12} - ES_{12}) &= 0 \\
                                c_1(H_{21} - ES_{21}) + c_2(H_{22} - ES_{22}) &= 0
                               \end{aligned} $$
                            これが自明でない解 (\(c_1, c_2\) が共に0でない解) を持つためには、係数行列式が0でなければならない。
                            $$ \begin{vmatrix}
                                H_{11} - ES_{11} & H_{12} - ES_{12} \\
                                H_{21} - ES_{21} & H_{22} - ES_{22}
                               \end{vmatrix} =0 $$
                            </p>
                        </li>
                        <li>
                            <p>(3)の永年方程式に与えられた値を代入すると ($S_{11}=S_{22}=1, S_{12}=S_{21}=0$)
                            $$ \begin{vmatrix}
                                -13 - E & -3 \\
                                -3 & -5 - E
                               \end{vmatrix} =0 $$
                            この行列式を計算すると
                            $$ (-13-E)(-5-E) - (-3)(-3) = 0 $$
                            $$ (E+13)(E+5) - 9 = 0 $$
                            $$ E^2 + 5E + 13E + 65 - 9 = 0 $$
                            $$ E^2 + 18E + 56 = 0 $$
                            この二次方程式を解くと、エネルギーの近似値は
                            $$ (E+14)(E+4) = 0 $$
                            $$ E_1 = -14 \; \mathrm{eV}, \quad E_2 = -4 \; \mathrm{eV} $$
                            よって<br>
                            基底状態のエネルギーの近似値は \(\boxed{-14 \; \mathrm{eV}}\)、第一励起状態のエネルギーの近似値は \(\boxed{-4 \; \mathrm{eV}}\) である。<br>
                            次に対応する波動関数を求める。
                            </p>
                            <ul class="list-disc pl-5 mt-2">
                                <li class="mt-1">
                                    <strong>\(E_1 = -14 \; \mathrm{eV}\) (基底状態) のとき:</strong><br>
                                    永年方程式の1行目に代入して
                                    $$ c_1(H_{11} - E_1 S_{11}) + c_2(H_{12} - E_1 S_{12}) = 0 $$
                                    $$ c_1(-13 - (-14)) + c_2(-3 - 0) = 0 $$
                                    $$ c_1(1) + c_2(-3) = 0 \quad \Longrightarrow \quad c_1 = 3c_2 $$
                                    波動関数の規格化条件 \(\int|\Psi|^2d\tau = c_1^2 S_{11} + c_2^2 S_{22} + 2c_1c_2 S_{12} = 1\) より (ここでは \(S_{12}=0, S_{11}=S_{22}=1\))
                                    $$ c_1^2 + c_2^2 = 1 $$
                                    $$ (3c_2)^2 + c_2^2 = 1 $$
                                    $$ 9c_2^2 + c_2^2 = 1 \implies 10c_2^2 = 1 \implies c_2 = \pm\frac{1}{\sqrt{10}} $$
                                    \(c_2 = \frac{1}{\sqrt{10}}\) を選ぶと \(c_1 = \frac{3}{\sqrt{10}}\)。
                                    したがって、基底状態の波動関数\(\Psi_1\)は
                                    $$ \boxed{\Psi_1 = \frac{3}{\sqrt{10}}\Psi_1 + \frac{1}{\sqrt{10}}\Psi_2} $$
                                </li>
                                <li class="mt-1">
                                    <strong>\(E_2 = -4 \; \mathrm{eV}\) (第一励起状態) のとき:</strong><br>
                                    永年方程式の1行目に代入して
                                    $$ c_1(-13 - (-4)) + c_2(-3 - 0) = 0 $$
                                    $$ c_1(-9) + c_2(-3) = 0 \quad \Longrightarrow \quad -9c_1 = 3c_2 \quad \Longrightarrow \quad c_2 = -3c_1 $$
                                    規格化条件 \(c_1^2 + c_2^2 = 1\) より
                                    $$ c_1^2 + (-3c_1)^2 = 1 $$
                                    $$ c_1^2 + 9c_1^2 = 1 \implies 10c_1^2 = 1 \implies c_1 = \pm\frac{1}{\sqrt{10}} $$
                                    \(c_1 = \frac{1}{\sqrt{10}}\) を選ぶと \(c_2 = \frac{-3}{\sqrt{10}}\)。
                                    したがって、第一励起状態の波動関数\(\Psi_2\)は
                                    $$ \boxed{\Psi_2 = \frac{1}{\sqrt{10}}\Psi_1 - \frac{3}{\sqrt{10}}\Psi_2} $$
                                </li>
                            </ul>
                        </li>
                    </ol>
                    <button class="gemini-button" onclick="fetchAiExplanation('problem-13')">
                        <span class="button-text">✨ AIによる追加解説を見る</span>
                        <span class="loading-spinner" style="display: none;"></span>
                    </button>
                    <div class="ai-explanation-box" id="ai-explanation-problem-13" style="display: none;">
                        <h4 class="ai-explanation-title">AIによる追加解説</h4>
                        <p class="ai-explanation-content"></p>
                    </div>
                </div>
            </section>

        </main>
        <footer class="text-center mt-12 pt-6 border-t border-gray-300">
            <p class="text-sm text-gray-600">&copy; 物理学演習問題解説</p>
        </footer>
    </div>

    <script>
        // --- Gemini API Call Function ---
        async function fetchAiExplanation(problemId) {
            const problemElement = document.getElementById(problemId);
            if (!problemElement) {
                console.error('Problem element not found:', problemId);
                return;
            }

            const button = problemElement.nextElementSibling.querySelector('.gemini-button'); // Assumes button is within the next solution-box or directly after problem-box
             if (!button) {
                // Fallback if the structure is slightly different, e.g. button inside the last solution-box of a multi-part solution
                const solutionBoxes = problemElement.parentElement.querySelectorAll('.solution-box');
                const lastSolutionBox = solutionBoxes[solutionBoxes.length -1];
                if (lastSolutionBox) {
                    const btnInLastBox = lastSolutionBox.querySelector('.gemini-button[onclick*="' + problemId + '"]');
                    if(btnInLastBox) button = btnInLastBox;
                }
                if (!button) {
                    console.error('Button not found for problemId:', problemId);
                    return;
                }
            }


            const buttonText = button.querySelector('.button-text');
            const spinner = button.querySelector('.loading-spinner');
            const explanationBox = document.getElementById('ai-explanation-' + problemId);
            const explanationContent = explanationBox.querySelector('.ai-explanation-content');

            // Show loading state
            buttonText.textContent = '解説を生成中...';
            spinner.style.display = 'inline-block';
            button.classList.add('loading');
            button.disabled = true;
            explanationBox.style.display = 'none'; // Hide previous content if any
            explanationContent.textContent = '';


            const problemTitleElement = problemElement.querySelector('.problem-title');
            const problemContentElement = problemElement.querySelector('.problem-content');
            
            let problemTitle = problemTitleElement ? problemTitleElement.innerText : "不明な問題";
            let problemDescription = problemContentElement ? problemContentElement.innerText : "説明なし";
            
            // Consolidate solutions if multiple solution boxes exist for this problem ID
            let solutionText = "";
            const solutionElements = Array.from(document.querySelectorAll('.solution-box')).filter(sb => {
                // This logic assumes problem-X is an ancestor or the button's onclick points to it.
                // A more robust way would be to link solutions to problems more directly if HTML structure allows.
                // For now, we'll try to find solution text near the problem.
                let prevSibling = sb.previousElementSibling;
                while(prevSibling && !prevSibling.classList.contains('problem-box')) {
                    prevSibling = prevSibling.previousElementSibling;
                }
                return prevSibling && prevSibling.id === problemId;
            });

            if (solutionElements.length > 0) {
                 solutionElements.forEach(solBox => {
                    const solContent = solBox.querySelector('.solution-content');
                    if (solContent) {
                         // Exclude the button and AI explanation box text from the solution
                        const tempDiv = solContent.cloneNode(true);
                        tempDiv.querySelectorAll('.gemini-button, .ai-explanation-box').forEach(el => el.remove());
                        solutionText += tempDiv.innerText.trim() + "\n\n";
                    }
                });
            } else {
                // Fallback if no specific solution box is linked, try to get the one immediately after the button's parent
                let currentElement = button.parentElement;
                 while(currentElement && !currentElement.classList.contains('solution-box')){
                    currentElement = currentElement.parentElement;
                 }
                 if(currentElement && currentElement.classList.contains('solution-box')){
                    const solContent = currentElement.querySelector('.solution-content');
                     if (solContent) {
                        const tempDiv = solContent.cloneNode(true);
                        tempDiv.querySelectorAll('.gemini-button, .ai-explanation-box').forEach(el => el.remove());
                        solutionText = tempDiv.innerText.trim();
                    }
                 }
            }
            solutionText = solutionText.trim() || "解答なし";


            const prompt = `以下の物理の問題と解答について、追加の解説や、より平易な言葉での説明、または関連する興味深い事実を日本語で生成してください。特に重要なポイントや、初心者がつまずきやすい点などを補足すると役立ちます。数式はLaTeX形式 (\`$...$\` または \`$$...$$\`) で記述してください。

問題タイトル: ${problemTitle}

問題文:
${problemDescription}

現在の解答:
${solutionText}

AIによる追加解説:`;

            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; // APIキーはCanvas環境により自動で提供されます
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`API request failed with status ${response.status}: ${errorBody}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    let generatedText = result.candidates[0].content.parts[0].text;
                    
                    // Replace markdown-style code blocks with paragraphs for better rendering,
                    // as MathJax will handle LaTeX within the text.
                    generatedText = generatedText.replace(/```latex\n([\s\S]*?)\n```/g, '<p>$$$1$$</p>');
                    generatedText = generatedText.replace(/```\n([\s\S]*?)\n```/g, '<p class="bg-gray-100 p-2 rounded my-2 whitespace-pre-wrap">$1</p>');
                    generatedText = generatedText.replace(/\n/g, '<br>'); // Convert newlines to <br> for HTML

                    explanationContent.innerHTML = generatedText; // Use innerHTML to render <br> and other potential HTML
                    explanationBox.style.display = 'block';
                    
                    // Re-render MathJax for the new content
                    if (window.MathJax) {
                        window.MathJax.typesetPromise([explanationBox])
                            .catch((err) => console.error('MathJax typesetting error:', err));
                    }
                } else {
                    explanationContent.textContent = 'AIからの解説を取得できませんでした。';
                    explanationBox.style.display = 'block';
                }

            } catch (error) {
                console.error('Error fetching AI explanation:', error);
                explanationContent.textContent = '解説の取得中にエラーが発生しました: ' + error.message;
                explanationBox.style.display = 'block';
            } finally {
                // Reset button state
                buttonText.textContent = '✨ AIによる追加解説を見る';
                spinner.style.display = 'none';
                button.classList.remove('loading');
                button.disabled = false;
            }
        }
    </script>

</body>
</html>
